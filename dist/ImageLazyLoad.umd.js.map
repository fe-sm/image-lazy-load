{"version":3,"file":"ImageLazyLoad.umd.js","sources":["../src/index.js"],"sourcesContent":["/**\n * core implementation of lazy load images\n *\n * @example\n */\nclass ImageLazyLoad {\n  /**\n   * constructor\n   *\n   * @param {HTMLElement} container - the dom wrapper you want to lazy load images\n   * @param {Object} option - configure the other behaviour\n   * @param {number} option.preloadHeight - extra downside height that will preload, default is 0\n   * @param {numbes} option.delay - delay to optimize high speed scroll, default is 0\n   */\n  constructor (container = document.documentElement, { preloadHeight = 0, delay = 0 } = { }) {\n    this.container = container\n    this.option = { preloadHeight, delay }\n\n    // maintain standalone timer\n    this.timer = null\n\n    // bind this\n    this.containerScrollHandler = this._onScroll.bind(this)\n\n    // and call it at first\n    this.containerScrollHandler()\n  }\n\n  /**\n   * initialize\n   *\n   * @private\n   */\n  _init () {\n    this.container.addEventListener('scroll', this.containerScrollHandler)\n  }\n\n  /**\n   * unbind events\n   *\n   * @private\n   */\n  _unbindEvents () {\n    this.container.removeEventListener('scroll', this.containerScrollHandler)\n  }\n\n  /**\n   * scroll listener\n   *\n   * @private\n   */\n  _onScroll () {\n    clearTimeout(this.timer)\n\n    this.timer = setTimeout(() => {\n      this._loadImagesCore()\n    }, this.option.delay)\n  }\n\n  /**\n   * load image core implementation\n   *\n   * @private\n   */\n  _loadImagesCore () {\n    const images = this.container.querySelectorAll('img')\n    const containerScrollTop = this.container.scrollTop\n    const containerHeight = this.container.offsetHeight\n\n    // load condition\n    // containerHeight + preloadHeight + containerScrollTop > the image's offsetTop\n    // in some layout, if one image fits this condition, the following images fit, too.\n    // this can be set a configuration.\n    const hasNotLoadedImages = [ ...images ].filter((image) => {\n      const loadedThisImage = image.dataset['__loaded']\n      const hasSrc = image.dataset('src')\n\n      // hasn't loaded & has src\n      return !loadedThisImage && hasSrc\n    })\n\n    if (hasNotLoadedImages.length === 0) {\n      this._unbindEvents()\n      return\n    }\n\n    hasNotLoadedImages.filter((image) => {\n      // and fit condition\n      return containerHeight + preloadHeight + containerScrollTop > image.offsetTop\n    })\n      .forEach((image) => {\n        const rawSrc = image.dataset('src')\n        image.src = rawSrc\n\n        image.dataset['__loaded'] = true\n      })\n  }\n\n  /**\n   * destroy\n   *\n   * @public\n   */\n  destroy () {\n    clearTimeout(this.timer)\n    this._unbindEvents()\n    this.container = null\n    this.option = null\n    this.timer = null\n  }\n}\n\nexport default ImageLazyLoad\n"],"names":["const"],"mappings":";;;;;;;;;;EAAA;;;;;EAKA,IAAM,aAAa,GASjB,sBAAW,EAAE,SAAoC,EAAE,GAAsC,EAAE;yCAArE,GAAG,QAAQ,CAAC;6BAAiD,GAAG;2FAAjB;2DAAW;;IAC9E,IAAI,CAAC,SAAS,GAAG,UAAS;IAC5B,IAAM,CAAC,MAAM,GAAG,iBAAE,aAAa,SAAE,KAAK,GAAE;;;IAGtC,IAAI,CAAC,KAAK,GAAG,KAAI;;;IAGnB,IAAM,CAAC,sBAAsB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAC;;;IAGzD,IAAM,CAAC,sBAAsB,GAAE;EAC/B,EAAC;;EAEH;;;;;EAKA,wBAAE,KAAK,qBAAI;IACT,IAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,sBAAsB,EAAC;EACxE,EAAC;;EAEH;;;;;EAKA,wBAAE,aAAa,6BAAI;IACjB,IAAM,CAAC,SAAS,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,sBAAsB,EAAC;EAC3E,EAAC;;EAEH;;;;;EAKA,wBAAE,SAAS,yBAAI;;;IACX,YAAY,CAAC,IAAI,CAAC,KAAK,EAAC;;IAExB,IAAI,CAAC,KAAK,GAAG,UAAU,aAAI;MAC3B,MAAM,CAAC,eAAe,GAAE;KACvB,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,EAAC;EACvB,EAAC;;EAEH;;;;;EAKA,wBAAE,eAAe,+BAAI;IACnB,IAAQ,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,KAAK,EAAC;IACvD,IAAQ,kBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,UAAS;IACrD,IAAQ,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,aAAY;;;;;;IAMnDA,IAAM,kBAAkB,GAAG,WAAK,MAAM,EAAE,CAAC,MAAM,WAAE,KAAK,EAAE;MACxD,IAAQ,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,EAAC;MACnD,IAAQ,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,EAAC;;;MAGnC,OAAO,CAAC,eAAe,IAAI,MAAM;KAClC,EAAC;;IAEF,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC,EAAE;MACrC,IAAM,CAAC,aAAa,GAAE;MACpB,MAAM;KACP;;IAED,kBAAkB,CAAC,MAAM,WAAE,KAAK,EAAE;;MAElC,OAAS,eAAe,GAAG,aAAa,GAAG,kBAAkB,GAAG,KAAK,CAAC,SAAS;KAC9E,CAAC;OACC,OAAO,WAAE,KAAK,EAAE;QACjB,IAAQ,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,EAAC;QACnC,KAAK,CAAC,GAAG,GAAG,OAAM;;QAElB,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,KAAI;OACjC,EAAC;EACN,EAAC;;EAEH;;;;;EAKA,wBAAE,OAAO,uBAAI;IACT,YAAY,CAAC,IAAI,CAAC,KAAK,EAAC;IAC1B,IAAM,CAAC,aAAa,GAAE;IACpB,IAAI,CAAC,SAAS,GAAG,KAAI;IACrB,IAAI,CAAC,MAAM,GAAG,KAAI;IAClB,IAAI,CAAC,KAAK,GAAG,KAAI;EACnB,CAAC,CACF;;;;;;;;;;;;"}