{"version":3,"file":"ImageLazyLoad.umd.js","sources":["../src/index.js"],"sourcesContent":["/**\r\n * core implementation of lazy load images\r\n *\r\n * @example\r\n */\r\nclass ImageLazyLoad {\r\n  /**\r\n   * constructor\r\n   *\r\n   * @param {HTMLElement} container - the dom wrapper you want to lazy load images\r\n   * @param {Object} option - configure the other behaviour\r\n   * @param {number} option.preloadHeight - extra downside height that will preload, default is 0\r\n   * @param {numbes} option.delay - delay to optimize high speed scroll, default is 0\r\n   */\r\n  constructor ({ preloadHeight = 0, delay = 0 } = { }, container = document ) {\r\n    this.container = container\r\n    this.option = { preloadHeight, delay }\r\n\r\n    // maintain standalone timer\r\n    this.timer = null\r\n\r\n    // bind this\r\n    this.containerScrollHandler = this._onScroll.bind(this)\r\n\r\n    // and call it at first\r\n    this.containerScrollHandler()\r\n  }\r\n\r\n  /**\r\n   * initialize\r\n   *\r\n   * @private\r\n   */\r\n  _init () {\r\n    this.container.addEventListener('scroll', this.containerScrollHandler)\r\n  }\r\n\r\n  /**\r\n   * unbind events\r\n   *\r\n   * @private\r\n   */\r\n  _unbindEvents () {\r\n    this.container.removeEventListener('scroll', this.containerScrollHandler)\r\n  }\r\n\r\n  /**\r\n   * scroll listener\r\n   *\r\n   * @private\r\n   */\r\n  _onScroll () {\r\n    clearTimeout(this.timer)\r\n\r\n    this.timer = setTimeout(() => {\r\n      this._loadImagesCore()\r\n    }, this.option.delay)\r\n  }\r\n\r\n  /**\r\n   * load image core implementation\r\n   *\r\n   * @private\r\n   */\r\n  _loadImagesCore () {\r\n    const images = this.container.querySelectorAll('img')\r\n    const containerScrollTop = this.container.nodeType === 9 ? document.documentElement.scrollTop : this.container.scrollTop\r\n    const containerHeight = this.container.nodeType === 9 ? document.documentElement.clientHeight : this.container.offsetHeight\r\n\r\n    // load condition\r\n    // in some layout, if one image fits this condition, the following images fit, too.\r\n    // this can be set a configuration.\r\n    const hasNotLoadedImages = [ ...images ].filter((image) => {\r\n      const loadedThisImage = image.dataset['__loaded']\r\n      const hasSrc = image.dataset['src']\r\n\r\n      // hasn't loaded & has src\r\n      return !loadedThisImage && hasSrc\r\n    })\r\n\r\n    if (hasNotLoadedImages.length === 0) {\r\n      this._unbindEvents()\r\n      return\r\n    }\r\n\r\n    hasNotLoadedImages.filter((image) => {\r\n      // and fit condition\r\n      const viewTop = image.offsetTop - containerScrollTop\r\n      return viewTop  < containerHeight + this.option.preloadHeight && viewTop > -image.offsetHeight\r\n    })\r\n      .forEach((image) => {\r\n        const rawSrc = image.dataset['src']\r\n        image.src = rawSrc\r\n        image.dataset['__loaded'] = true\r\n      })\r\n  }\r\n\r\n  /**\r\n   * destroy\r\n   *\r\n   * @public\r\n   */\r\n  destroy () {\r\n    clearTimeout(this.timer)\r\n    this._unbindEvents()\r\n    this.container = null\r\n    this.option = null\r\n    this.timer = null\r\n  }\r\n}\r\nexport default ImageLazyLoad"],"names":["const","this"],"mappings":";;;;;;;;;;EAAA;;;;;EAKA,IAAM,aAAa,GASjB,sBAAW,EAAE,GAAsC,EAAE,SAAoB,GAAG;6BAA/B,GAAG;2FAAjB;2DAAW;yCAAoB,GAAG;;IAC/D,IAAI,CAAC,SAAS,GAAG,UAAS;IAC5B,IAAM,CAAC,MAAM,GAAG,iBAAE,aAAa,SAAE,KAAK,GAAE;;;IAGtC,IAAI,CAAC,KAAK,GAAG,KAAI;;;IAGnB,IAAM,CAAC,sBAAsB,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,EAAC;;;IAGzD,IAAM,CAAC,sBAAsB,GAAE;EAC/B,EAAC;;EAEH;;;;;EAKA,wBAAE,KAAK,qBAAI;IACT,IAAM,CAAC,SAAS,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,sBAAsB,EAAC;EACxE,EAAC;;EAEH;;;;;EAKA,wBAAE,aAAa,6BAAI;IACjB,IAAM,CAAC,SAAS,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,sBAAsB,EAAC;EAC3E,EAAC;;EAEH;;;;;EAKA,wBAAE,SAAS,yBAAI;;;IACX,YAAY,CAAC,IAAI,CAAC,KAAK,EAAC;;IAExB,IAAI,CAAC,KAAK,GAAG,UAAU,aAAI;MAC3B,MAAM,CAAC,eAAe,GAAE;KACvB,EAAE,IAAI,CAAC,MAAM,CAAC,KAAK,EAAC;EACvB,EAAC;;EAEH;;;;;EAKA,wBAAE,eAAe,+BAAI;;;IACnB,IAAQ,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,KAAK,EAAC;IACvD,IAAQ,kBAAkB,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,KAAK,CAAC,GAAG,QAAQ,CAAC,eAAe,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,UAAS;IAC1H,IAAQ,eAAe,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,KAAK,CAAC,GAAG,QAAQ,CAAC,eAAe,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,aAAY;;;;;IAK3HA,IAAM,kBAAkB,GAAG,WAAK,MAAM,EAAE,CAAC,MAAM,WAAE,KAAK,EAAE;MACxD,IAAQ,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,EAAC;MACnD,IAAQ,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,EAAC;;;MAGnC,OAAO,CAAC,eAAe,IAAI,MAAM;KAClC,EAAC;;IAEF,IAAI,kBAAkB,CAAC,MAAM,KAAK,CAAC,EAAE;MACrC,IAAM,CAAC,aAAa,GAAE;MACpB,MAAM;KACP;;IAED,kBAAkB,CAAC,MAAM,WAAE,KAAK,EAAE;;MAElC,IAAQ,OAAO,GAAG,KAAK,CAAC,SAAS,GAAG,mBAAkB;MACpD,OAAO,OAAS,EAAE,eAAe,GAAGC,MAAI,CAAC,MAAM,CAAC,aAAa,IAAI,OAAO,GAAG,CAAC,KAAK,CAAC,YAAY;KAC/F,CAAC;OACC,OAAO,WAAE,KAAK,EAAE;QACjB,IAAQ,MAAM,GAAG,KAAK,CAAC,OAAO,CAAC,KAAK,EAAC;QACnC,KAAK,CAAC,GAAG,GAAG,OAAM;QAClB,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,KAAI;OACjC,EAAC;EACN,EAAC;;EAEH;;;;;EAKA,wBAAE,OAAO,uBAAI;IACT,YAAY,CAAC,IAAI,CAAC,KAAK,EAAC;IAC1B,IAAM,CAAC,aAAa,GAAE;IACpB,IAAI,CAAC,SAAS,GAAG,KAAI;IACrB,IAAI,CAAC,MAAM,GAAG,KAAI;IAClB,IAAI,CAAC,KAAK,GAAG,KAAI;EACnB,CAAC,CACF;;;;;;;;;;;;"}